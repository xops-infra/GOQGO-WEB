# Agentè¿‡æ»¤åŠŸèƒ½è°ƒè¯•æŒ‡å—

## é—®é¢˜æè¿°

Agentç”¨æˆ·è¿‡æ»¤åŠŸèƒ½å¯èƒ½æ²¡æœ‰æŒ‰é¢„æœŸå·¥ä½œï¼Œéœ€è¦é€šè¿‡æ§åˆ¶å°æ—¥å¿—å’Œè°ƒè¯•é¡µé¢æ¥æ’æŸ¥é—®é¢˜ã€‚

## è°ƒè¯•å·¥å…·

### 1. æ§åˆ¶å°è°ƒè¯•ä¿¡æ¯

å·²åœ¨ä»¥ä¸‹ä½ç½®æ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼š

#### AgentsView.vue - filteredAgentsè®¡ç®—å±æ€§
- æ˜¾ç¤ºåŸå§‹Agentæ•°æ®
- æ˜¾ç¤ºå½“å‰ç”¨æˆ·ä¿¡æ¯
- æ˜¾ç¤ºæ¯ä¸ªAgentçš„è¿‡æ»¤æ£€æŸ¥è¿‡ç¨‹
- æ˜¾ç¤ºæœ€ç»ˆè¿‡æ»¤ç»“æœ

#### AgentsView.vue - refreshAgentsæ–¹æ³•
- æ˜¾ç¤ºAPIè°ƒç”¨è¿‡ç¨‹
- æ˜¾ç¤ºè·å–åˆ°çš„Agentæ•°æ®
- æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®ä½¿ç”¨æƒ…å†µ

#### UserStore - isAdminè®¡ç®—å±æ€§
- æ˜¾ç¤ºç”¨æˆ·æƒé™æ£€æŸ¥è¿‡ç¨‹
- æ˜¾ç¤ºç®¡ç†å‘˜åˆ¤æ–­é€»è¾‘

### 2. è°ƒè¯•é¡µé¢

è®¿é—® `/test/agent-filter-debug` é¡µé¢è¿›è¡Œå¯è§†åŒ–è°ƒè¯•ï¼š

- **ç”¨æˆ·ä¿¡æ¯é¢æ¿**: æ˜¾ç¤ºå½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯
- **åŸå§‹æ•°æ®é¢æ¿**: æ˜¾ç¤ºæœªè¿‡æ»¤çš„Agentæ•°æ®
- **è¿‡æ»¤æ§åˆ¶é¢æ¿**: æ‰‹åŠ¨æµ‹è¯•è¿‡æ»¤åŠŸèƒ½
- **è¿‡æ»¤ç»“æœé¢æ¿**: æ˜¾ç¤ºè¿‡æ»¤åçš„æ•°æ®å’ŒåŒ¹é…åŸå› 
- **è°ƒè¯•æ—¥å¿—é¢æ¿**: å®æ—¶æ˜¾ç¤ºè¿‡æ»¤è¿‡ç¨‹æ—¥å¿—

## è°ƒè¯•æ­¥éª¤

### 1. æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
console.log('ç”¨æˆ·çŠ¶æ€:', {
  isAuthenticated: userStore.isAuthenticated,
  username: userStore.username,
  displayName: userStore.displayName,
  isAdmin: userStore.isAdmin,
  currentUser: userStore.currentUser
})
```

### 2. æ£€æŸ¥Agentæ•°æ®

è®¿é—® `/agents` é¡µé¢ï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š

```
ğŸ” [Agentè¿‡æ»¤] åŸå§‹Agentæ•°æ®: {...}
ğŸ” [Agentè¿‡æ»¤] ç”¨æˆ·ä¿¡æ¯: {...}
ğŸ” [Agentè¿‡æ»¤] æ£€æŸ¥Agent: {...}
ğŸ” [Agentè¿‡æ»¤] æœ€ç»ˆç»“æœ: {...}
```

### 3. ä½¿ç”¨è°ƒè¯•é¡µé¢

1. è®¿é—® `/test/agent-filter-debug`
2. æ£€æŸ¥ç”¨æˆ·ä¿¡æ¯æ˜¯å¦æ­£ç¡®
3. åŠ è½½æ¨¡æ‹Ÿæ•°æ®
4. è§‚å¯Ÿè¿‡æ»¤ç»“æœ
5. æŸ¥çœ‹è°ƒè¯•æ—¥å¿—

### 4. å¸¸è§é—®é¢˜æ’æŸ¥

#### é—®é¢˜1: ç”¨æˆ·ä¿¡æ¯ä¸æ­£ç¡®
- æ£€æŸ¥æ˜¯å¦æ­£ç¡®ç™»å½•
- æ£€æŸ¥localStorageä¸­çš„ç”¨æˆ·æ•°æ®
- æ£€æŸ¥userStoreçš„çŠ¶æ€

#### é—®é¢˜2: è¿‡æ»¤é€»è¾‘ä¸ç”Ÿæ•ˆ
- æ£€æŸ¥Agentæ•°æ®ä¸­æ˜¯å¦æœ‰usernameå­—æ®µ
- æ£€æŸ¥ç”¨æˆ·åå¤§å°å†™æ˜¯å¦åŒ¹é…
- æ£€æŸ¥ç®¡ç†å‘˜æƒé™åˆ¤æ–­é€»è¾‘

#### é—®é¢˜3: APIæ•°æ®æ ¼å¼é—®é¢˜
- æ£€æŸ¥APIè¿”å›çš„æ•°æ®ç»“æ„
- ç¡®è®¤usernameå­—æ®µå­˜åœ¨ä¸”æ­£ç¡®
- æ£€æŸ¥æ¨¡æ‹Ÿæ•°æ®æ˜¯å¦ä¸APIæ ¼å¼ä¸€è‡´

## é¢„æœŸè¡Œä¸º

### æ™®é€šç”¨æˆ· (éç®¡ç†å‘˜)
- åªèƒ½çœ‹åˆ°usernameå­—æ®µä¸å½“å‰ç”¨æˆ·ååŒ¹é…çš„Agent
- å¤§å°å†™ä¸æ•æ„Ÿæ¯”è¾ƒ
- ç”¨æˆ·åè¿‡æ»¤å™¨ä¸å¯ç”¨

### ç®¡ç†å‘˜ç”¨æˆ·
- å¯ä»¥çœ‹åˆ°æ‰€æœ‰Agent
- å¯ä»¥ä½¿ç”¨ç”¨æˆ·åè¿‡æ»¤å™¨è¿›ä¸€æ­¥ç­›é€‰
- ç•Œé¢æ˜¾ç¤º"(å·²è¿‡æ»¤: ç”¨æˆ·å)"æç¤º

## è°ƒè¯•è¾“å‡ºç¤ºä¾‹

### æ­£å¸¸å·¥ä½œçš„è¾“å‡º
```
ğŸ” [Agentè¿‡æ»¤] åŸå§‹Agentæ•°æ®: {total: 4, agents: [...]}
ğŸ” [Agentè¿‡æ»¤] ç”¨æˆ·ä¿¡æ¯: {currentUsername: "zhoushoujian", isAdminUser: false}
ğŸ” [Agentè¿‡æ»¤] æ£€æŸ¥Agent: {agentName: "user-agent-1", agentUsername: "zhoushoujian", match: true}
ğŸ” [Agentè¿‡æ»¤] ç”¨æˆ·æƒé™è¿‡æ»¤ç»“æœ: {beforeFilter: 4, afterFilter: 2}
ğŸ” [Agentè¿‡æ»¤] æœ€ç»ˆç»“æœ: {total: 2, agents: [...]}
```

### é—®é¢˜è¾“å‡ºç¤ºä¾‹
```
ğŸ” [Agentè¿‡æ»¤] ç”¨æˆ·ä¿¡æ¯: {currentUsername: "", isAdminUser: false}  // ç”¨æˆ·åä¸ºç©º
ğŸ” [Agentè¿‡æ»¤] æ£€æŸ¥Agent: {agentUsername: undefined, match: false}  // Agentæ²¡æœ‰usernameå­—æ®µ
```

## ä¿®å¤å»ºè®®

### 1. ç”¨æˆ·åä¸ºç©º
- æ£€æŸ¥ç™»å½•æµç¨‹
- ç¡®è®¤tokenè§£ææ­£ç¡®
- æ£€æŸ¥ç”¨æˆ·æ•°æ®å­˜å‚¨

### 2. Agentæ•°æ®ç¼ºå°‘usernameå­—æ®µ
- æ£€æŸ¥APIè¿”å›æ ¼å¼
- æ›´æ–°æ¨¡æ‹Ÿæ•°æ®ç»“æ„
- ç¡®è®¤åç«¯æ•°æ®æ­£ç¡®

### 3. ç®¡ç†å‘˜æƒé™åˆ¤æ–­é”™è¯¯
- æ£€æŸ¥ç”¨æˆ·è§’è‰²å­—æ®µ
- ç¡®è®¤ç®¡ç†å‘˜åˆ¤æ–­é€»è¾‘
- æ›´æ–°æƒé™æ£€æŸ¥æ¡ä»¶

## æ¸…ç†è°ƒè¯•ä¿¡æ¯

è°ƒè¯•å®Œæˆåï¼Œå¯ä»¥ç§»é™¤æˆ–æ³¨é‡Šæ‰è°ƒè¯•æ—¥å¿—ï¼š

```javascript
// å°†è¯¦ç»†çš„console.logæ”¹ä¸ºç®€å•çš„æ—¥å¿—
console.log('ğŸ” [Agentè¿‡æ»¤] æœ€ç»ˆç»“æœ:', result.length)
```

æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡æ§åˆ¶ï¼š

```javascript
if (import.meta.env.DEV) {
  console.log('ğŸ” [Agentè¿‡æ»¤] è°ƒè¯•ä¿¡æ¯:', ...)
}
```
