# GoQGo Web TODO List

## 🔧 代码重构计划

### 1. WebSocket消息处理统一化 (优先级: 中)
**问题**: 当前 `chatSocket.ts` 和 `chat.ts` 两个文件都在处理消息，容易导致重复处理和逻辑混乱

**重构方案**:
- **方案A**: 将所有消息处理逻辑合并到 `chat.ts` 中
  - `chatSocket.ts` 只负责纯网络通信
  - 提供统一的 `onWebSocketMessage` 回调
  - `chat.ts` 统一处理所有消息类型

- **方案B**: 保持当前分离，但明确职责边界
  - `chatSocket.ts`: 消息接收、格式化、基础验证
  - `chat.ts`: 业务逻辑处理、状态管理、UI更新

**当前状态**: 已修复重复处理问题，功能正常工作

### 2. Agent思考流程优化 (优先级: 低)
**改进点**:
- 统一思考消息的创建和更新逻辑
- 优化流式更新的性能
- 改进错误处理和超时机制

### 3. 消息状态管理优化 (优先级: 低)
**改进点**:
- 简化消息状态转换逻辑
- 统一消息ID管理（tempId vs messageId）
- 优化消息确认机制

## 🐛 已修复的问题

### ✅ Agent Reply 重复处理问题 (2025-08-06)
- **问题**: `agent_reply` 消息被 `chatSocket.ts` 和 `chat.ts` 重复处理
- **解决方案**: 
  - 在 `chatSocket.ts` 中过滤重复的 agent 回复消息
  - 添加 `replaceThinking` 标记确保思考消息正确替换
  - 根据 `conversationId` 精确匹配和替换思考消息
- **提交**: a4476fd

## 📋 功能增强计划

### 1. 错误处理改进 (优先级: 中)
- 添加更详细的错误提示
- 实现消息重发机制
- 优化网络异常处理

### 2. 性能优化 (优先级: 低)
- 消息列表虚拟滚动
- 图片懒加载
- WebSocket连接池管理

### 3. 用户体验优化 (优先级: 中)
- 消息发送状态更明确的视觉反馈
- 思考过程的动画效果优化
- 快捷键支持

## 🧪 测试计划

### 1. Agent功能测试
- [ ] @agent 消息发送和接收
- [ ] 思考流程显示和替换
- [ ] 多Agent并发处理
- [ ] 错误场景处理

### 2. 消息功能测试
- [ ] 普通文本消息
- [ ] 图片消息上传和显示
- [ ] 历史消息加载
- [ ] 消息状态同步

### 3. 网络异常测试
- [ ] 断网重连
- [ ] 消息发送失败
- [ ] WebSocket连接异常

## 📝 开发规范

### 代码风格
- 使用 TypeScript 严格模式
- 遵循 Vue 3 Composition API 最佳实践
- 保持函数单一职责原则

### 提交规范
- feat: 新功能
- fix: 修复问题
- refactor: 代码重构
- perf: 性能优化
- test: 测试相关
- docs: 文档更新

### 分支管理
- main: 主分支，稳定版本
- develop: 开发分支
- feature/*: 功能分支
- hotfix/*: 紧急修复分支

---

**最后更新**: 2025-08-06
**维护者**: Amazon Q
