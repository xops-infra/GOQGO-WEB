# CHANGELOG

## [2025-07-31] - 窗口重置和按钮状态识别

### 新增功能
- 再次点击已打开窗口的按钮时，窗口重置到初始位置并置顶
- 已打开日志窗口的按钮显示蓝色背景，提供视觉识别
- 按钮tooltip文本动态变化：未打开显示"查看日志"，已打开显示"重置日志窗口"
- 窗口重置时自动置顶，确保用户能看到操作结果

### 用户体验改进
- 按钮状态一目了然，用户可以清楚知道哪些窗口已打开
- 重复点击不会关闭窗口，而是重置位置，更符合用户预期
- 窗口重置后自动置顶，避免被其他窗口遮挡
- 按钮颜色和边框提供清晰的视觉反馈

### 技术实现
- 使用时间戳触发窗口重置和置顶操作
- 动态检查窗口状态，实时更新按钮样式
- 通过props传递重置和置顶信号
- CSS样式区分激活和非激活状态

## [2025-07-31] - 真正的多窗口日志系统

### 重大改进
- 完全移除n-modal，使用原生div实现真正的窗口效果
- 无背景遮罩，完全不阻塞主页面操作
- 支持多个日志窗口同时显示，用户可自由排列
- 使用Teleport将窗口渲染到body，避免层级问题

### 窗口管理功能
- 智能窗口位置分布，使用螺旋式算法避免重叠
- 点击窗口自动置顶，支持多窗口层级管理
- 每个实例只保留一个窗口，重复点击重置位置
- 窗口边界检测，确保不会超出屏幕范围

### 用户体验
- 真正的桌面级窗口体验
- 支持拖拽移动和调整大小
- ESC键关闭当前焦点窗口
- 窗口焦点管理和视觉反馈

### 技术实现
- 使用固定定位(position: fixed)实现窗口效果
- Teleport组件确保窗口渲染在正确位置
- 动态z-index管理实现窗口层级
- 螺旋式位置算法优化多窗口分布

## [2025-07-31] - 多窗口日志管理和主页面操作优化

### 新增功能
- 支持多个Agent日志窗口同时打开，不阻塞主页面操作
- 每个Agent实例只保留一个日志窗口，重复点击会重置窗口
- 日志窗口打开时自动重置到初始位置和默认大小
- 多窗口智能位置偏移，避免完全重叠
- 移除模态框遮罩，允许用户继续操作主页面

### 技术实现
- 重构Layout组件，使用数组管理多个日志窗口
- 每个日志窗口独立管理状态和WebSocket连接
- 窗口位置和大小每次打开时重置到默认值
- 优化CSS层级，确保窗口不阻塞主页面交互

### 用户体验
- 可以同时查看多个Agent的日志
- 点击已打开的Agent日志按钮会重置窗口位置
- 日志窗口不会阻塞主页面的其他操作
- 多窗口自动错位显示，避免重叠

## [2025-07-31] - 修复实例点击事件和UI优化

### 修复问题
- 修复实例列表中点击事件不工作的问题
- 修正Layout组件中selectAgent方法调用错误
- 优化实例操作按钮的可见性，默认显示30%透明度
- 选中状态的实例操作按钮完全可见

### 用户体验改进
- 实例操作按钮现在更容易被发现
- 悬停和选中状态都会显示完整的操作按钮
- 添加调试日志便于问题排查

## [2025-07-31] - Agent日志查看功能

### 新增功能
- 新增可拖拽调整大小的Agent日志模态框
- 支持实时WebSocket日志流，自动显示Agent运行日志
- 日志按级别分类显示（info、warn、error、debug）
- 支持日志跟随模式，自动滚动到最新日志
- 支持手动清空日志内容
- 模态框支持拖拽移动和调整大小
- 连接状态实时显示和日志统计

### 技术实现
- 移除废弃的attach接口，使用新的logs流式接口
- 实现WebSocket日志流连接：`/api/v1/namespaces/:namespace/agents/:agentname/logs/stream`
- 支持日志查询参数：lines（行数）、follow（跟随模式）、since（时间过滤）
- 终端风格的日志渲染，支持时间戳、日志级别、来源显示
- 响应式设计，支持不同屏幕尺寸

### 用户体验
- 在Agent列表中添加日志查看按钮
- 模态框居中显示，支持ESC键关闭
- 智能滚动：跟随模式下自动滚动，手动滚动时停止跟随
- 空状态提示和连接状态指示

## [2025-07-31] - Socket连接和历史消息加载

### 新增功能
- 重构 ChatSocket 类，支持更好的连接管理和消息处理
- 实现 WebSocket 历史消息加载，连接时自动获取聊天历史
- 支持滚动到顶部时自动加载更多历史消息
- 添加连接状态指示器，显示连接断开状态
- 优化消息滚动行为，智能判断是否自动滚动到底部

### 技术改进
- 使用回调模式重构 socket 连接，提高代码可维护性
- 添加重连机制，支持指数退避重连策略
- 实现消息去重，避免重复显示相同消息
- 优化滚动性能，保持历史消息加载时的滚动位置

### 用户体验
- 历史消息加载状态提示
- 智能滚动：发送消息时自动滚动到底部，浏览历史时保持位置
- 连接状态实时反馈

## [1.0.0] - 2025-07-30

### Fixed
- **Agent自动选择功能**：
  - 获取agents列表后自动选择第一个agent，避免显示"选择一个实例来观察"
  - 创建新agent后自动选择该agent
  - 删除agent后智能选择下一个可用的agent
  - 切换namespace时自动选择该namespace下的第一个agent
- **Namespace选择器显示问题**：
  - 修复Naive UI组件未正确注册导致的渲染问题
  - 在main.ts中正确配置naive-ui全局注册
- **Namespace agents数量显示错误**：
  - 动态获取每个namespace下的真实agents数量
  - 修复选择器显示"(0)"但实际有agents的问题
- **默认namespace选择逻辑**：
  - 首次访问时自动选择第一个可用的namespace
  - 正确记住用户上次选择的namespace到localStorage
  - 当保存的namespace不存在时，自动切换到第一个可用的
- **完整的Namespace管理功能**：
  - 通过API获取namespace列表，显示agents数量和状态
  - 支持创建新namespace，包含名称验证和描述
  - 支持删除namespace（保护default namespace）
  - 智能的namespace选择器，显示agents数量
  - 完整的namespace管理界面，支持切换、查看详情
- **数据关联和自动更新**：
  - 切换namespace时自动更新agents列表
  - 通过CustomEvent实现跨组件通信
  - 创建/删除agents时自动更新namespace的agents计数
- **用户体验优化**：
  - localStorage记住用户选择的namespace
  - 切换namespace时显示loading状态
  - 完善的错误处理和fallback机制
  - 空状态提示和引导用户创建
  - 删除确认对话框，防止误操作
- 项目初始化，基于Vue 3 + TypeScript + Naive UI
- 集成GoQGo.svg作为项目logo，应用于侧边栏和favicon
- 全新的Q Chat Manager界面布局，完全按照设计图实现：
  - 紫色渐变顶部标题栏，显示"Q Chat Manager"和"AI助手管理平台"
  - 左侧Q CLI实例列表面板，显示backend、frontend、q_cli_system等实例
  - 中间黑色终端区域，支持命令行交互
  - 右侧聊天记录面板，支持实时消息交互
  - 底部状态栏，显示命名空间、实例数量等信息
- 真实API集成，支持与后端GoQGo API Server完全交互
- 智能fallback机制，API失败时自动使用模拟数据
- 实例管理功能：创建、删除、发送消息、查看日志
- **完整的Namespace管理功能**：
  - 右上角namespace选择器和管理按钮
  - 支持创建、删除、切换命名空间
  - 命名空间列表管理界面，显示状态和创建时间
  - 删除确认机制，防止误删重要命名空间
  - 自动切换namespace时重新加载对应的agents
  - 与后端API完全集成，支持真实的namespace CRUD操作
- 响应式设计和主题切换

### Fixed
- 修复useMessage在setup中使用导致的空白页面问题
- 移除对naive-ui message provider的依赖，使用console输出替代
- 修复ChatView.vue中的导入错误
- **修复API数据结构处理问题**：
  - 修复namespaces.value.map错误，正确处理API返回的{items: []}格式
  - 更新Agent类型定义，匹配后端API实际返回的数据结构
  - 修复agents和namespaces store中的数据处理逻辑
  - 更新模拟数据结构，与真实API保持一致
- **修复useMessage错误**：
  - 移除ChatRoom组件中未使用的useMessage导入和变量定义
  - 避免在没有message-provider的情况下使用useMessage
- **修复API路径重复问题**：
  - 修复axios baseURL配置，避免/api/api/v1路径重复
  - 更新为直接连接后端API服务器http://localhost:8080/api
- **修复页面布局问题**：
  - 恢复正确的标题"AI助手管理平台"
  - 移除不必要的聊天室按钮，保持原有设计
  - 清理未使用的导入和方法
- **增强聊天功能容错性**：
  - 为不存在的聊天API添加fallback机制
  - 提供模拟聊天历史和在线用户数据
  - 确保即使后端聊天服务不可用，前端也能正常工作

### Changed
- 完全重新设计界面布局，符合Q Chat Manager设计规范
- 简化路由结构，使用单页面布局
- 更新API接口，支持完整的GoQGo后端功能
- 重构状态管理，分离namespace和agents管理
## [2025-07-30] 图片聊天功能

### 新增功能
- 支持图片粘贴：用户可直接粘贴剪贴板图片到聊天
- 支持文件拖拽：用户可拖拽图片文件到聊天窗口上传
- 图片上传按钮：点击选择本地图片文件
- 图片消息展示：聊天窗口中显示图片消息
- 图片全屏预览：点击图片可放大查看
- 图片路径格式：`[图片](/path/to/image.png)` 格式支持

### 技术实现
- 新增 `ImageMessage.vue` 组件处理图片展示
- 新增 `imageUtils.ts` 工具函数处理图片操作
- 更新 `ChatMessage` 接口支持图片类型
- 更新 `ChatRoom.vue` 组件支持图片粘贴和上传
- 更新 `ChatSocket` 类支持图片消息传输

### 修复问题
- 修复Vue组件中粘贴事件监听器绑定问题
- 添加多种DOM元素查找方式确保事件正确绑定
- 增加详细的调试日志便于问题排查
- 优化事件监听器的添加时机和方式

### 拖拽功能
- 支持拖拽图片文件到聊天窗口
- 拖拽时显示视觉反馈覆盖层
- 自动识别图片文件类型
- 支持 PNG, JPG, GIF, WebP, BMP 等格式
